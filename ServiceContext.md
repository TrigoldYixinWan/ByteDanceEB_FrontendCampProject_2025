[项目服务级别 Context —— 提供给其它 Code Agent 使用]

## 一、项目基本信息

- 项目名称：商家知识管理系统与问答机器人（Merchant KMS + RAG Chatbot）
- 项目类型：面向商家的自助知识管理 + 智能问答服务平台
- 典型使用场景：电商平台商家（例如抖音电商）需要快速查找运营规则、入驻流程、商品管理规范等知识，并希望通过类似豆包/ChatGPT 的聊天界面进行 7x24 小时咨询。

本文件的作用：

- 为所有参与本项目的 code agent 提供统一的「业务与服务层级」背景信息。
- 帮助 agent 在实现代码之前理解：我们在解决什么问题、有哪些模块、各模块负责什么、模块之间预期的协同关系。
- 不包含任何具体技术栈、代码结构、数据库设计等细节，这些交由具体工程实现 agent（例如 Copilot）去推导和生成。

## 二、业务背景与问题

1. 电商平台/商家面临的问题
   - 平台规则、运营手册、入驻指南、违规处理说明等知识分散在多个页面或 PDF 文档中，难以系统管理。
   - 新商家 / 新员工在运营中经常会遇到相同问题（如何入驻、怎么上架、怎么改价、售后怎么处理等），但缺乏统一的知识入口。
   - 传统 FAQ 或静态文档很难覆盖不断更新的政策与玩法，也难以提供「根据上下文、多轮对话」的动态答疑体验。

2. 我们希望提供的价值
   - 为每个商家提供一个「自己的知识库」：可以把外部学习资料、平台规则文档、本店 SOP 等放在一起管理。
   - 为商家提供一个 7x24 可用的「智能问答机器人」，回答基于商家知识库，而非闭门编造。
   - 提供可视化洞察，帮助商家看清：
     - 哪些知识被问得最多（热知识点）
     - 用户经常问什么问题（高频问题）
     - 哪些问题目前知识库无法回答（知识缺口）

## 三、目标用户与角色

1. 商家管理员（Merchant Admin）
   - 角色描述：店铺运营负责人、资深客服主管等，负责维护店铺知识体系。
   - 关键需求：
     - 能够方便地上传和管理知识文档。
     - 能知道知识是否已经被解析、生效。
     - 能看到机器人如何使用这些知识（哪些内容被引用、哪些问题没有命中）。

2. 商家普通使用者（Merchant Staff/User）
   - 角色描述：日常运营、客服、新员工等。
   - 关键需求：
     - 能用聊天方式提问，得到清晰可靠的回答。
     - 能查看回答引用的具体文档片段，从而确认答案可信。
     - 能在移动端或 PC 上方便使用。

## 四、产品总体目标（服务层面）

1. 提供一个商家可自管理的知识库（KMS Service）：
   - 支持分类、上传、解析、状态管理。
   - 知识结构围绕「业务 → 场景 → 文档 → 文档片段」。

2. 提供一个基于 RAG 的智能问答服务（RAG/Chat Service）：
   - 机器人回答必须基于商家知识库检索结果。
   - 支持多轮对话与对话历史管理。
   - 具备未来扩展多模态问答（图片、语音等）的能力。

3. 提供可视化洞察（Analytics Service）：
   - 知识点引用热力图：展示哪些文档/片段使用频次最高。
   - 高频问题 Top N：帮助识别常见咨询问题。
   - 零命中问题列表：帮助识别知识库缺口。

4. 为未来多模态扩展预留空间（Multimodal Service）：
   - 支持上传图片/截图作为知识或提问输入。
   - 支持从图片、视频中抽取可检索的文本或特征。

## 五、核心服务模块概览

从服务职责的角度，我们将项目拆分为四大服务域（不对应具体技术实现，仅代表责任边界）：

1. KMS Service（知识管理服务）
   - 面向商家管理员提供：知识的创建、分类、存储与生命周期管理。
   - 面向其它服务（例如 RAG）提供：可检索的知识片段、元数据。

2. RAG & Chat Service（检索增强生成 + 聊天服务）
   - 面向商家使用者提供：自然语言提问 + 智能回答。
   - 面向 KMS/Analytics 提供：知识引用记录、会话记录。

3. Analytics Service（可视化与洞察服务）
   - 面向商家管理员提供：知识使用情况、问题分布、命中率等统计。
   - 面向 KMS/RAG 服务消费：知识引用日志、会话日志。

4. Multimodal Service（多模态扩展服务）
   - 为未来的图片/视频/语音输入与知识管理提供服务抽象。
   - 目前只在业务语义上定义职责，为后续模型与工具预留空间。

## 六、KMS Service：业务功能与责任

KMS（知识管理系统）是整个项目的基础，它负责承载「商家运营相关的全部知识」。从业务角度，KMS 要完成：

1. 知识结构管理
   - 业务（Business）：例如「商家入驻」「商品管理」「订单与售后」「活动与营销」「平台规则」等。
   - 场景（Scene）：如「入驻流程指引」「商品上架规范」「价格调整规则」「退货退款流程」。
   - 商家管理员可以创建/编辑/删除业务和场景，形成树状或分组结构。

2. 知识文档管理
   - 支持两种主要知识来源：
     - 上传 PDF 文档（如平台学习中心资料、平台规则文档）。
     - 手动编辑文本（如内部 SOP、临时说明）。
   - 每个文档关联到一个业务和一个场景，并可以添加标签（Tag）。
   - 文档有明确的状态：
     - 创建中：刚录入，还未处理。
     - 处理中：正在解析或向量化。
     - 生效中：已可供机器人使用。
     - 已失效：不再参与回答，但可保留历史记录。

3. 文档解析与切片（从业务角度）
   - 上传的 PDF/文本需要被拆解成「更细颗粒度」的知识片段（段落、条款等）。
   - 每个片段要携带：
     - 其来源文档信息（标题、业务、场景）。
     - 在文档中的位置（例如第几页、第几段）。
     - 适合检索的内容文本。
   - 解析过程可能需要一定时间，因此文档状态会从「处理中」到「生效中」。

4. 文档检索能力（面向管理员）
   - 管理界面需要支持：
     - 按业务/场景/状态过滤文档。
     - 按关键词搜索文档标题或正文内容。
   - 管理员可以快速定位某个文档或某类文档进行编辑或下线。

5. 知识使用记录（为 Analytics 提供原始数据）
   - 当 RAG/Chat Service 在回答中使用了某个知识片段，KMS 需要记录：
     - 哪个片段被使用；
     - 属于哪个文档/业务/场景；
     - 在什么时间、哪个会话中被使用。
   - 这些记录不会由管理员手动维护，但会在 Analytics 中以可视化方式呈现。

## 七、RAG & Chat Service：业务功能与责任

该服务的任务：将 KMS 中的知识转化为「可用的智能问答体验」。

1. 聊天会话管理
   - 面向每位商家使用者：
     - 创建新会话；
     - 继续历史会话；
     - 查看历史问答内容。
   - 每个会话应包含：
     - 会话名称（可自动命名为首个问题的摘要）。
     - 消息列表（用户消息、机器人消息、时间戳）。
   - 会话本身可以与商家账号绑定（后续拓展权限和统计）。

2. 提问与回答（RAG 流程的业务视角）
   - 用户输入问题（自然语言文本）。
   - 系统按如下业务逻辑处理（不涉及实现细节）：
     1. 理解问题的大致意图（例如属于哪个业务/场景，可能涉及哪些规则）。
     2. 在 KMS 提供的知识片段中，检索一组最相关的片段。
     3. 基于这些片段和问题本身，构造一个「适合回答」的上下文。
     4. 调用大模型生成自然语言回答。
     5. 将回答与对应的「知识引用信息」一起返回给用户。
   - 回答需求：
     - 语言自然、尽量口语化但保持专业。
     - 强调基于文档而非凭空猜测，如遇知识不足要明确说明。
     - 支持多轮对话：后续问题可以依赖会话上下文。

3. 引用信息展示（Source Attribution）
   - 在机器人回答下面，需要展示被引用的知识片段：
     - 段落简要预览。
     - 对应的文档标题。
     - 所属业务/场景。
     - 点击或跳转到文档详情页面的能力。
   - 这是本系统与「纯模型回答」最大的区别：用户可以追溯答案来源。

4. 对话质量与安全
   - 在业务层面，对话需要遵守：
     - 不提供明显错误、与平台规则冲突的信息（在知识缺失时要提示）。
     - 避免输出与业务无关或敏感内容（例如法律/医疗诊断等）。
   - 这些约束未来会结合 Prompt 设计与规则过滤实现。

5. 与 Analytics 的关系
   - 每一次问答都需要产生日志记录：
     - 提问文本；
     - 是否成功命中知识库；
     - 被引用的片段集合；
     - 响应时间等。
   - 这些日志会被 Analytics Service 用于计算「命中率、高频问题、零命中问题」等指标。

## 八、Analytics Service：业务功能与责任

Analytics 不是一个独立对外的系统，而是给商家管理员提供的「运营洞察后台」。

1. 知识引用热力图
   - 展示某段时间范围内：
     - 各业务/场景/文档/片段的被引用次数。
   - 可以表现为：
     - 业务层面的热力矩阵（不同业务的咨询量与引用量）。
     - 单个文档内部不同片段的引用频率（帮助优化文档结构）。

2. 高频问题 Top N
   - 对所有会话中的问题进行归类与统计。
   - 展示一组「最常被问到的问题」，用来指导：
     - 招聘与培训（重点培训这些问题）。
     - 文档优化（针对高频问题打磨更清晰的说明）。
     - 产品策略（若高频集中在某类操作，说明该流程可能不够直观）。

3. 零命中问题列表
   - 统计那些在知识库检索阶段没有找到合适片段的问题。
   - 为每个问题标注：
     - 问题内容；
     - 出现次数；
     - 大致归属的业务/场景（可由简单分类器/规则推断）；
   - 商家管理员可以据此决定：
     - 是否需要新增某类文档；
     - 是否需要补充现有文档内容。

4. 运营维度的其它指标（可选）
   - 会话量趋势（按天/周/月）。
   - 平均响应时间。
   - 机器人回答满意度（未来可通过打分或反馈实现）。

## 九、Multimodal Service：业务功能与责任（预留）

当前阶段，多模态部分的目标是「预留空间」，确保未来易于扩展，而非立即实现。

1. 多模态知识输入
   - 商家可能上传：
     - 截图（例如平台后台页面的截图）。
     - 产品图片（用于解释某类问题）。
     - 含文字的宣传页、流程图。
   - Multimodal Service 需要在业务层面支持：
     - 将图片/视频等「非文本资料」也纳入知识库管理。
     - 通过 OCR 或视觉模型抽取可检索的文本或特征。

2. 多模态问答
   - 用户在提问时可以附带图片：
     - 例如上传一张报错页面截图，让机器人解释错误含义和处理方式。
   - 机器人需要将图片信息和文字问题综合考虑后回答。

3. 与 KMS/RAG 的关系
   - 图片/视频经过处理后，会转化为：
     - 可检索的文本（类似特殊文档）。
     - 或独立的「视觉向量」，由 RAG 检索。
   - 从业务视角看，Multimodal 只是扩展了「知识输入形式」和「提问方式」，原则仍是：
     - 回答基于知识库，而不是凭空猜测。

## 十、典型用户旅程（简化）

1. 商家管理员视角
   - 步骤：
     1. 登录知识管理后台。
     2. 创建几个「业务 → 场景」（例如：商家入驻 → 入驻流程指引）。
     3. 上传平台学习中心的 PDF 文档，对应到上述业务和场景。
     4. 等待文档解析完成，看到状态从「处理中」变为「生效中」。
     5. 打开 Analytics，看哪些文档在被使用，哪些问题没有命中。
     6. 根据零命中列表，再补充一份新的文档。

2. 商家普通用户视角
   - 步骤：
     1. 打开问答机器人页面（PC 或手机）。
     2. 提问：「我想入驻这个平台，需要准备什么资料？」
     3. 机器人返回答案，并附带一个「来自《商家入驻流程手册》第 2 章」的引用。
     4. 用户点击引用，跳转到具体文档片段进行阅读。
     5. 用户继续追问：「审核一般需要多久？如果失败了怎么办？」
     6. 机器人基于同一会话上下文与相关文档继续回答。

## 十一、范围与非目标（Scope / Non-goals）

当前项目聚焦：

- 业务上：
  - 单平台、单商家的知识管理与问答体验（不做复杂多租户平台）。
  - 重点是「知识可管理」和「问答可解释」，而不是做一个通用对话大模型平台。
- 技术上：
  - 保证工程框架可扩展、模块边界清晰，后续可以按需求替换模型或存储实现。
- 体验上：
  - 界面不追求极致设计，但要结构清晰、性能可接受、交互流畅。

明确的非目标：

- 不在本阶段实现复杂的权限/角色体系（如多层审批等）。
- 不构建面向公众的开放平台（目前面向「一个项目内部」或有限商家使用）。
- 不将统计分析做成 BI 级别系统，仅完成核心可视化需求。

## 十二、对其它 Code Agent 的期望

当你作为一个代码生成 Agent 参与本项目时，请遵守以下原则：

1. 所有实现都应围绕上述四大服务域（KMS / RAG & Chat / Analytics / Multimodal）的职责展开，避免模块间逻辑混杂。
2. 在实现任何接口或类之前，先对照本 context，思考：
   - 这个接口属于哪个服务？
   - 它服务的是哪类用户？（管理员 / 普通用户 / 内部服务）
   - 它对外暴露的「业务含义」是什么？
3. 所有与知识相关的读写操作，都应该通过 KMS 的抽象来进行；所有对话行为，都应通过 RAG & Chat 的抽象来进行；统计类逻辑，只应在 Analytics 中聚合。
4. 如需增加新功能（例如新的可视化图表或新的知识分类方式），请优先在业务描述水平（服务职责）对齐后，再让工程类 agent 负责具体代码实现。

本 context 会作为「业务与服务设计的单一事实来源」，请在生成和修改代码前后尽量与其保持一致。
